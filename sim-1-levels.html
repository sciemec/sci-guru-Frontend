<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Virtual Experiment: Levels of Organisation</title>
  <link rel="stylesheet" href="styles.css"/>

  <style>
    .wrap{padding:18px 0 30px;}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px;}
    .card2{border:1px solid var(--border);border-radius:16px;background:rgba(255,255,255,.03);padding:14px;}
    .small2{color:var(--muted);font-size:.93rem;line-height:1.45;}
    .badge2{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);font-weight:900;}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);font-weight:900;}
    .btn2{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--text);font-weight:900;cursor:pointer;}
    .btn2.primary{border-color:rgba(47,107,255,.55);box-shadow:0 0 0 4px rgba(47,107,255,.12);}
    .board{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:12px;}
    .slot{border:1px solid var(--border);border-radius:14px;background:rgba(255,255,255,.03);padding:10px;min-height:150px;}
    .slot h4{margin:0 0 8px;font-size:0.98rem;}
    .drop{border:2px dashed rgba(47,107,255,.55);border-radius:12px;background:rgba(47,107,255,.07);padding:8px;min-height:86px;}
    .drop.good{border-style:solid;border-color:rgba(56,214,120,.75);background:rgba(56,214,120,.10);}
    .drop.bad{border-style:solid;border-color:rgba(255,98,98,.75);background:rgba(255,98,98,.10);}
    .items{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;}
    .item{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.04);cursor:grab;font-weight:900;user-select:none;}
    .toast{margin-top:12px;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:rgba(255,255,255,.03);white-space:pre-wrap;}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    .tab{padding:10px 12px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04);font-weight:900;cursor:pointer;}
    .tab.active{border-color:rgba(47,107,255,.55);box-shadow:0 0 0 4px rgba(47,107,255,.12);}
    @media (max-width:980px){
      .grid{grid-template-columns:1fr}
      .board{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
<header class="topbar">
  <div class="container row">
    <div class="brand">
      <img src="images/lec-logo.png" alt="LEC Biotec Logo">
      <div class="title">
        <b>Virtual Experiment: Levels of Organisation</b>
        <span>Cell → Tissue → Organ → System → Organism</span>
      </div>
    </div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="tutor.html">AI Tutor</a>
      <a class="active" href="sim-levels.html">Levels Lab</a>
      <a href="sim-cells-hub.html">Topic 2 Hub</a>
    </nav>
  </div>
</header>

<main class="container wrap">
  <div class="row" style="gap:10px;flex-wrap:wrap;margin-bottom:10px;">
    <span class="pill">Form 1</span>
    <span class="pill">Topic 2: Cells & Levels of organisation</span>
    <span class="badge2" id="score">Score: 0</span>
    <span class="badge2" id="done">Correct: 0/10</span>
  </div>

  <div class="grid">
    <!-- BOARD -->
    <section class="card2">
      <h2 style="margin:0 0 6px;">Drag & Drop Challenge</h2>
      <div class="small2">
        Drag each item to the correct level. You can switch between <b>Human</b> and <b>Plant</b> examples.
      </div>

      <div class="tabs" id="tabs">
        <div class="tab active" data-set="human">Human examples</div>
        <div class="tab" data-set="plant">Plant examples</div>
      </div>

      <div class="board">
        <div class="slot">
          <h4>Cell</h4>
          <div class="drop" data-level="cell">Drop items here</div>
        </div>
        <div class="slot">
          <h4>Tissue</h4>
          <div class="drop" data-level="tissue">Drop items here</div>
        </div>
        <div class="slot">
          <h4>Organ</h4>
          <div class="drop" data-level="organ">Drop items here</div>
        </div>
        <div class="slot">
          <h4>System</h4>
          <div class="drop" data-level="system">Drop items here</div>
        </div>
        <div class="slot">
          <h4>Organism</h4>
          <div class="drop" data-level="organism">Drop items here</div>
        </div>
      </div>

      <div class="toast" id="toast">
Tip: A <b>tissue</b> is a group of similar cells working together (e.g., muscle tissue).
An <b>organ</b> is made of different tissues working together (e.g., heart).
      </div>
    </section>

    <!-- ITEMS + CONTROLS -->
    <aside class="card2">
      <h2 style="margin:0 0 6px;">Items</h2>
      <div class="small2">Items appear below. Each one can be used once. Click Reset if you want to try again.</div>

      <div class="items" id="items"></div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn2 primary" id="check">Check all</button>
        <button class="btn2" id="reset">Reset</button>
        <button class="btn2" id="auto">Auto-complete</button>
        <a class="btn2" href="sim-cells-hub.html">Back to Topic 2 Hub</a>
      </div>

      <div class="card2" style="margin-top:12px;box-shadow:none;">
        <b>Quick explanation</b>
        <div class="small2" style="margin-top:6px;">
          Cell → Tissue → Organ → System → Organism<br>
          Example (human): muscle cell → muscle tissue → heart → circulatory system → human
        </div>
      </div>

      <div class="card2" style="margin-top:12px;box-shadow:none;">
        <b>Worked example task</b>
        <div class="small2" style="margin-top:6px;">
          Put these in correct order:<br>
          1) leaf  2) palisade tissue  3) maize plant  4) palisade cell  5) shoot system
        </div>
      </div>
    </aside>
  </div>
</main>

<script>
  // Data sets (10 items each)
  const SETS = {
    human: [
      {id:"muscle_cell", name:"Muscle cell", level:"cell"},
      {id:"nerve_cell", name:"Nerve cell (neurone)", level:"cell"},
      {id:"muscle_tissue", name:"Muscle tissue", level:"tissue"},
      {id:"blood_tissue", name:"Blood (tissue)", level:"tissue"},
      {id:"heart", name:"Heart", level:"organ"},
      {id:"lung", name:"Lung", level:"organ"},
      {id:"circulatory", name:"Circulatory system", level:"system"},
      {id:"respiratory", name:"Respiratory system", level:"system"},
      {id:"human", name:"Human (person)", level:"organism"},
      {id:"dog", name:"Dog", level:"organism"}
    ],
    plant: [
      {id:"root_hair_cell", name:"Root hair cell", level:"cell"},
      {id:"palisade_cell", name:"Palisade cell", level:"cell"},
      {id:"xylem_tissue", name:"Xylem tissue", level:"tissue"},
      {id:"palisade_tissue", name:"Palisade tissue", level:"tissue"},
      {id:"leaf", name:"Leaf", level:"organ"},
      {id:"root", name:"Root", level:"organ"},
      {id:"shoot_system", name:"Shoot system", level:"system"},
      {id:"root_system", name:"Root system", level:"system"},
      {id:"maize", name:"Maize plant", level:"organism"},
      {id:"bean", name:"Bean plant", level:"organism"}
    ]
  };

  const tabs = document.getElementById("tabs");
  const itemsEl = document.getElementById("items");
  const drops = [...document.querySelectorAll(".drop")];
  const toast = document.getElementById("toast");
  const scoreEl = document.getElementById("score");
  const doneEl = document.getElementById("done");

  const checkBtn = document.getElementById("check");
  const resetBtn = document.getElementById("reset");
  const autoBtn = document.getElementById("auto");

  let activeSet = "human";
  let placed = {}; // itemId -> level
  let score = 0;

  function renderItems(){
    itemsEl.innerHTML = "";
    const list = SETS[activeSet];

    for(const it of list){
      const div = document.createElement("div");
      div.className = "item";
      div.textContent = it.name + (placed[it.id] ? " ✓" : "");
      div.draggable = !placed[it.id];
      div.dataset.id = it.id;

      div.addEventListener("dragstart", (e)=>{
        e.dataTransfer.setData("text/plain", it.id);
      });

      itemsEl.appendChild(div);
    }
  }

  function resetDropsUI(){
    for(const d of drops){
      d.classList.remove("good","bad");
      d.textContent = "Drop items here";
      d.dataset.items = "";
    }
  }

  function placeItem(itemId, level){
    // prevent double placing
    if(placed[itemId]) return;

    placed[itemId] = level;

    // store in drop bucket
    const drop = drops.find(x => x.dataset.level === level);
    const current = drop.dataset.items ? drop.dataset.items.split(",").filter(Boolean) : [];
    current.push(itemId);
    drop.dataset.items = current.join(",");

    // show short list
    const names = current.map(id => getItemName(id));
    drop.textContent = names.join(", ");
  }

  function getItemName(id){
    return SETS[activeSet].find(x => x.id === id)?.name || id;
  }

  function correctLevel(id){
    return SETS[activeSet].find(x => x.id === id)?.level;
  }

  function updateScoreUI(correctCount, total){
    doneEl.textContent = `Correct: ${correctCount}/${total}`;
    scoreEl.textContent = `Score: ${score}`;
  }

  function checkAll(){
    let correct = 0;
    let total = SETS[activeSet].length;

    // reset state
    for(const d of drops) d.classList.remove("good","bad");

    for(const it of SETS[activeSet]){
      const lvl = placed[it.id];
      if(!lvl) continue;

      if(lvl === it.level) correct++;
    }

    // mark each drop box good/bad depending on its contents
    for(const d of drops){
      const lvl = d.dataset.level;
      const ids = d.dataset.items ? d.dataset.items.split(",").filter(Boolean) : [];
      if(ids.length === 0) continue;

      // if all inside are correct -> good else bad
      const allCorrect = ids.every(id => placed[id] === correctLevel(id) && correctLevel(id) === lvl);
      d.classList.add(allCorrect ? "good" : "bad");
    }

    // score logic
    score = correct * 2 - (total - correct) * 0.5; // reward correct, small penalty for mistakes
    score = Math.round(score);

    updateScoreUI(correct, total);

    if(correct === total){
      toast.textContent = "✅ Perfect! You understand the levels of organisation.";
    }else{
      toast.textContent = `You got ${correct}/${total} correct. Review:\n• Tissue = group of similar cells\n• Organ = different tissues together\n• System = organs working together\nTry again or switch sets.`;
    }
  }

  // Drag & drop handlers
  drops.forEach(d=>{
    d.addEventListener("dragover", e=>e.preventDefault());
    d.addEventListener("drop", (e)=>{
      e.preventDefault();
      const itemId = e.dataTransfer.getData("text/plain");
      if(!itemId) return;

      const lvl = d.dataset.level;
      placeItem(itemId, lvl);
      renderItems();
    });
  });

  // Tabs
  tabs.addEventListener("click", (e)=>{
    const tab = e.target.closest(".tab");
    if(!tab) return;
    activeSet = tab.dataset.set;

    [...tabs.querySelectorAll(".tab")].forEach(t=>t.classList.toggle("active", t.dataset.set === activeSet));

    // Reset state when switching
    placed = {};
    score = 0;
    resetDropsUI();
    renderItems();
    updateScoreUI(0, SETS[activeSet].length);
    toast.textContent = activeSet === "human"
      ? "Human set loaded. Example: muscle cell → muscle tissue → heart → circulatory system → human."
      : "Plant set loaded. Example: palisade cell → palisade tissue → leaf → shoot system → maize plant.";
  });

  // Buttons
  checkBtn.onclick = checkAll;

  resetBtn.onclick = ()=>{
    placed = {};
    score = 0;
    resetDropsUI();
    renderItems();
    updateScoreUI(0, SETS[activeSet].length);
    toast.textContent = "Reset done. Try again.";
  };

  autoBtn.onclick = ()=>{
    placed = {};
    resetDropsUI();
    for(const it of SETS[activeSet]){
      placeItem(it.id, it.level);
    }
    renderItems();
    checkAll();
  };

  // Init
  resetDropsUI();
  renderItems();
  updateScoreUI(0, SETS[activeSet].length);
</script>
</body>
</html>
