<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sci-Guru AI Science Tutor</title>
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* ---- extra styles just for chapter tags & small tweaks ---- */

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #f4f6fb;
      color: #0b1736;
    }

    .sg-header-bar {
      background: linear-gradient(90deg, #1b2b7b, #2e6bff);
      color: #fff;
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sg-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sg-header-left img {
      height: 36px;
      width: auto;
      border-radius: 4px;
      background: #fff;
      padding: 2px;
    }

    .sg-header-title {
      font-size: 0.95rem;
      line-height: 1.3;
    }

    .sg-header-title strong {
      display: block;
      font-size: 1.05rem;
    }

    .sg-nav-links {
      display: flex;
      gap: 0.5rem;
    }

    .sg-nav-links a {
      font-size: 0.9rem;
      padding: 0.4rem 0.85rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.5);
      color: #fff;
      text-decoration: none;
      background: rgba(11, 23, 54, 0.25);
    }

    .sg-nav-links a.active {
      background: #ffffff;
      color: #1b2b7b;
      font-weight: 600;
    }

    .sg-main-wrap {
      max-width: 1200px;
      margin: 1.5rem auto 2rem;
      padding: 0 1rem;
    }

    .sg-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 1.5rem;
      align-items: flex-start;
    }

    .sg-card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.08);
      padding: 1.5rem 1.6rem;
    }

    .sg-card h2 {
      margin: 0 0 0.25rem;
      font-size: 1.1rem;
    }

    .sg-helper-text {
      font-size: 0.85rem;
      color: #5b6485;
      margin-bottom: 0.75rem;
    }

    label {
      font-size: 0.85rem;
      color: #3a4266;
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }

    select,
    textarea,
    input[type="number"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #d4d9f2;
      padding: 0.55rem 0.65rem;
      font-size: 0.9rem;
      box-sizing: border-box;
      font-family: inherit;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .sg-row {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 0.9rem;
    }

    .sg-btn {
      border-radius: 999px;
      border: none;
      padding: 0.6rem 1.1rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: transform 0.1s ease, box-shadow 0.1s ease,
        background 0.1s ease;
      white-space: nowrap;
    }

    .sg-btn.primary {
      background: radial-gradient(circle at top left, #28d17c, #08a34e);
      color: #ffffff;
      box-shadow: 0 9px 20px rgba(5, 138, 69, 0.45);
    }

    .sg-btn.secondary {
      background: #ffffff;
      color: #1b2b7b;
      border: 1px solid #cbd3ff;
    }

    .sg-btn.outline {
      background: #ffffff;
      color: #1b2b7b;
      border: 1px solid #b9c1ff;
    }

    .sg-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
    }

    .sg-checkbox-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.7rem;
      font-size: 0.8rem;
      color: #4b5270;
    }

    .sg-score-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }

    .sg-score-row input[type="number"] {
      max-width: 80px;
    }

    .sg-badge-live {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      margin-top: 0.6rem;
      font-size: 0.8rem;
      color: #117a3a;
    }

    .sg-badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #2ecc71;
      box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.25);
    }

    /* ---- Results card ---- */

    .sg-results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .sg-results-header h2 {
      margin: 0;
      font-size: 1.05rem;
    }

    .sg-chapter-status {
      font-size: 0.78rem;
      color: #6b7395;
      text-align: right;
    }

    .sg-result-block {
      background: #0b1224;
      color: #eef1ff;
      border-radius: 14px;
      padding: 0.9rem 1rem;
      margin-bottom: 0.6rem;
      min-height: 70px;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .sg-result-block h3 {
      margin: 0;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      color: #4e8dff;
      text-transform: uppercase;
    }

    .sg-result-text {
      font-size: 0.86rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    /* ---- Chapter tags ---- */

    .sg-chapter-strip {
      margin-top: 0.9rem;
      padding-top: 0.6rem;
      border-top: 1px dashed #d4d9f2;
    }

    .sg-chapter-strip-label {
      font-size: 0.8rem;
      color: #6b7395;
      margin-bottom: 0.35rem;
    }

    .sg-chapter-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .chapter-tag {
      border-radius: 999px;
      border: 1px solid #cbd3ff;
      background: #f4f6ff;
      color: #1b2b7b;
      font-size: 0.78rem;
      padding: 0.2rem 0.7rem;
      cursor: pointer;
      transition: background 0.12s ease, color 0.12s ease,
        border-color 0.12s ease, transform 0.1s ease;
    }

    .chapter-tag:hover {
      transform: translateY(-1px);
      background: #e1e6ff;
    }

    .chapter-tag.active {
      background: #2e6bff;
      color: #ffffff;
      border-color: #2e6bff;
      box-shadow: 0 0 0 2px rgba(46, 107, 255, 0.2);
    }

    /* ---- Responsive ---- */

    @media (max-width: 900px) {
      .sg-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 600px) {
      .sg-header-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .sg-nav-links {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }

      .sg-card {
        padding: 1.25rem 1.1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Top bar with logo and nav -->
  <header class="sg-header-bar">
    <div class="sg-header-left">
      <!-- Your LEC Biotec / Sci-Guru logo -->
      <img src="lec-logo.jpg" alt="LEC Biotec logo" />
      <div class="sg-header-title">
        <strong>Sci-Guru AI Science Tutor</strong>
        <span>Zimbabwe’s AI-powered tutor for the ZIMSEC / Heritage-Based curriculum</span>
      </div>
    </div>
    <nav class="sg-nav-links">
      <a href="index.html">Home</a>
      <a href="tutor.html" class="active">AI Tutor</a>
    </nav>
  </header>

  <main class="sg-main-wrap">
    <div class="sg-layout">
      <!-- LEFT: Ask Sci-Guru -->
      <section class="sg-card" aria-label="Ask Sci-Guru">
        <h2>Ask Sci-Guru</h2>
        <p class="sg-helper-text">
          Choose a form and chapter (or topic), then ask your question in simple English.
        </p>

        <!-- Form / Level -->
        <div class="sg-field">
          <label for="form">Form / Level</label>
          <select id="form">
            <option value="Form 1" selected>Form 1</option>
            <option value="Form 2">Form 2</option>
            <option value="Form 3">Form 3</option>
            <option value="Form 4">Form 4</option>
          </select>
        </div>

        <!-- Topic select (Form 1 topics grouped + general) -->
        <div class="sg-field" style="margin-top: 0.65rem;">
          <label for="topic">Topic (Form 1 topics grouped + general)</label>
          <select id="topic">
            <option value="">-- Optional: choose a topic --</option>

            <optgroup label="General">
              <option value="General science">General science</option>
              <option value="Study skills and safety in the lab">
                Study skills and safety in the lab
              </option>
            </optgroup>

            <optgroup label="Form 1 — Biology">
              <option value="Living things and characteristics of life">
                Living things and characteristics of life
              </option>
              <option value="Cells and simple microscopes">
                Cells and simple microscopes
              </option>
              <option value="Human body systems and hygiene">
                Human body systems and hygiene
              </option>
              <option value="Ecosystems and environment">
                Ecosystems and environment
              </option>
            </optgroup>

            <optgroup label="Form 1 — Physics & Chemistry">
              <option value="States of matter">States of matter</option>
              <option value="Mixtures and separation methods">
                Mixtures and separation methods
              </option>
              <option value="Density and flotation">Density and flotation</option>
              <option value="Electricity and magnetism">
                Electricity and magnetism
              </option>
            </optgroup>
          </select>
        </div>

        <!-- Question -->
        <div class="sg-field" style="margin-top: 0.65rem;">
          <label for="question">Your question</label>
          <textarea
            id="question"
            placeholder="Explain density using Zimbabwean examples..."
          ></textarea>
        </div>

        <!-- Buttons -->
        <div class="sg-row">
          <button id="btnExplain" class="sg-btn primary">Ask Sci-Guru</button>
          <button id="btnQuiz" class="sg-btn secondary">Generate quiz</button>
        </div>

        <div class="sg-row">
          <button id="btnPractical" class="sg-btn outline">
            Generate practical
          </button>
          <button
            id="btnOpenLabHub"
            class="sg-btn outline"
            type="button"
            onclick="openVirtualLabHub()"
          >
            Open virtual lab hub
          </button>
        </div>

        <!-- Save quiz score -->
        <div class="sg-checkbox-row">
          <input type="checkbox" id="saveScoreToggle" checked />
          <label for="saveScoreToggle" style="font-weight: 400; margin: 0;">
            I want to save my quiz result for this topic
          </label>
        </div>

        <div class="sg-score-row">
          <span>I scored</span>
          <input id="scoreInput" type="number" min="0" max="100" placeholder="e.g. 75" />
          <span>%</span>
          <button id="btnSaveScore" class="sg-btn primary" style="padding-inline: 0.9rem;">
            Save topic score
          </button>
        </div>

        <div class="sg-badge-live">
          <span class="sg-badge-dot"></span>
          <span>Sci-Guru is ready. Backend: <strong>LIVE.</strong></span>
        </div>
      </section>

      <!-- RIGHT: Results + chapter tags -->
      <section class="sg-card" aria-label="Results">
        <div class="sg-results-header">
          <h2>Results</h2>
          <div class="sg-chapter-status" id="chapterStatus">
            No chapter tag selected (you can still ask any question).
          </div>
        </div>

        <div class="sg-result-block">
          <h3>Explanation</h3>
          <div id="explanation" class="sg-result-text">
            Sci-Guru will answer here…
          </div>
        </div>

        <div class="sg-result-block">
          <h3>Quiz</h3>
          <div id="quiz" class="sg-result-text">Quiz will appear here…</div>
        </div>

        <div class="sg-result-block">
          <h3>Practical</h3>
          <div id="practical" class="sg-result-text">
            Practical experiment will appear here…
          </div>
        </div>

        <!-- Chapter tags strip -->
        <div class="sg-chapter-strip">
          <div class="sg-chapter-strip-label">
            <strong>Form 1 chapters</strong> · Tap a chapter to auto-fill topic, sample
            question &amp; experiment focus.
          </div>
          <div class="sg-chapter-tags" id="chapterTags">
            <button class="chapter-tag" data-ch="1">Ch. 1</button>
            <button class="chapter-tag" data-ch="2">Ch. 2</button>
            <button class="chapter-tag" data-ch="3">Ch. 3</button>
            <button class="chapter-tag" data-ch="4">Ch. 4</button>
            <button class="chapter-tag" data-ch="5">Ch. 5</button>
            <button class="chapter-tag" data-ch="6">Ch. 6</button>
            <button class="chapter-tag" data-ch="7">Ch. 7</button>
            <button class="chapter-tag" data-ch="8">Ch. 8</button>
            <button class="chapter-tag" data-ch="9">Ch. 9</button>
            <button class="chapter-tag" data-ch="10">Ch. 10</button>
            <button class="chapter-tag" data-ch="11">Ch. 11</button>
            <button class="chapter-tag" data-ch="12">Ch. 12</button>
            <button class="chapter-tag" data-ch="13">Ch. 13</button>
            <button class="chapter-tag" data-ch="14">Ch. 14</button>
            <button class="chapter-tag" data-ch="15">Ch. 15</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    const API_BASE = "https://sci-guru-backend.onrender.com/api";

    const formSelect = document.getElementById("form");
    const topicSelect = document.getElementById("topic");
    const questionInput = document.getElementById("question");
    const explanationDiv = document.getElementById("explanation");
    const quizDiv = document.getElementById("quiz");
    const practicalDiv = document.getElementById("practical");

    const btnExplain = document.getElementById("btnExplain");
    const btnQuiz = document.getElementById("btnQuiz");
    const btnPractical = document.getElementById("btnPractical");
    const btnSaveScore = document.getElementById("btnSaveScore");

    const saveScoreToggle = document.getElementById("saveScoreToggle");
    const scoreInput = document.getElementById("scoreInput");
    const chapterStatus = document.getElementById("chapterStatus");
    const chapterButtons = document.querySelectorAll(".chapter-tag");

    // --- Chapter configuration (topic + sample question + experiment hint) ---
    const chapterConfig = {
      1: {
        label: "Ch. 1 – Living things & characteristics of life",
        topic: "Living things and characteristics of life",
        question:
          "Explain the characteristics of living things using Zimbabwean examples like crops, goats and borehole water organisms.",
        experimentHint:
          "Design a simple observation experiment where learners compare living and non-living items around the school yard, recording which characteristics of life they show."
      },
      2: {
        label: "Ch. 2 – Cells and simple microscopes",
        topic: "Cells and simple microscopes",
        question:
          "Explain cells and simple microscopes for Form 1 learners using Zimbabwean classroom examples.",
        experimentHint:
          "Create a simple practical where learners make a temporary onion cell slide (or leaf epidermis) and observe it using a simple or improvised microscope."
      },
      3: {
        label: "Ch. 3 – Human body systems and hygiene",
        topic: "Human body systems and hygiene",
        question:
          "Explain human body systems and hygiene using everyday Zimbabwean life examples.",
        experimentHint:
          "Suggest a hygiene experiment such as comparing bacterial growth on unwashed vs washed hands using slices of bread or agar plates."
      },
      4: {
        label: "Ch. 4 – Ecosystems and environment",
        topic: "Ecosystems and environment",
        question:
          "Explain ecosystems and the environment using Zimbabwean villages, townships and national parks as examples.",
        experimentHint:
          "Design a field-based mini investigation where learners observe biotic and abiotic factors in the school grounds and map simple food chains."
      },
      5: {
        label: "Ch. 5 – States of matter",
        topic: "States of matter",
        question:
          "Explain states of matter with Zimbabwean examples like cooking sadza, boiling water and LPG gas.",
        experimentHint:
          "Plan an experiment where learners heat water and record temperature changes during melting and boiling, linking to particle arrangement."
      },
      6: {
        label: "Ch. 6 – Mixtures and separation methods",
        topic: "Mixtures and separation methods",
        question:
          "Explain mixtures and separation methods using local examples like mealie-meal and sand, borehole water and cooking oil.",
        experimentHint:
          "Create a separation practical where learners separate a mixture containing sand, salt and iron filings using magnet, filtration and evaporation."
      },
      7: {
        label: "Ch. 7 – Density and flotation",
        topic: "Density and flotation",
        question:
          "Explain density and flotation using Zimbabwean examples like imbokodo vs plastic bucket in water.",
        experimentHint:
          "Describe a density experiment using stones, wood blocks and water to compare masses and volumes, predicting which objects float or sink."
      },
      8: {
        label: "Ch. 8 – Electricity and magnetism",
        topic: "Electricity and magnetism",
        question:
          "Explain basic electricity and magnetism using examples like phone chargers, torches and ZESA power lines.",
        experimentHint:
          "Plan a simple circuit investigation using dry cells, bulbs and switches to test complete and incomplete circuits."
      },
      // The remaining chapters can be extension / revision chapters
      9: {
        label: "Ch. 9 – Revision: Living things & cells",
        topic: "Living things and characteristics of life",
        question:
          "Give a revision summary that links living things and cells for Form 1 learners.",
        experimentHint:
          "Suggest a revision practical where learners group cards of structures and functions, matching them to organs and cells."
      },
      10: {
        label: "Ch. 10 – Revision: Human body & hygiene",
        topic: "Human body systems and hygiene",
        question:
          "Give a revision explanation on human body systems and hygiene for Form 1.",
        experimentHint:
          "Plan a health-focused practical where learners design posters or simple demonstrations on the importance of hand-washing and balanced diet."
      },
      11: {
        label: "Ch. 11 – Revision: Ecosystems & environment",
        topic: "Ecosystems and environment",
        question:
          "Summarise ecosystems and environmental conservation using Zimbabwean examples.",
        experimentHint:
          "Describe a school-yard survey where learners count plant species or insects and discuss biodiversity."
      },
      12: {
        label: "Ch. 12 – Revision: States of matter & mixtures",
        topic: "States of matter",
        question:
          "Link states of matter and mixtures in one explanation for Form 1 learners.",
        experimentHint:
          "Combine changes of state with separation methods, e.g. evaporating salty water to obtain salt."
      },
      13: {
        label: "Ch. 13 – Revision: Density & flotation",
        topic: "Density and flotation",
        question:
          "Provide a revision explanation on density and flotation using Zimbabwean river and boat examples.",
        experimentHint:
          "Design a mini investigation where learners change shape of plasticine to see how it affects floating and sinking."
      },
      14: {
        label: "Ch. 14 – Revision: Electricity & magnetism",
        topic: "Electricity and magnetism",
        question:
          "Give a revision summary on electricity and magnetism for Form 1.",
        experimentHint:
          "Suggest a circuit-building or electromagnet practical using nails, wire and dry cells."
      },
      15: {
        label: "Ch. 15 – End-of-form mixed review",
        topic: "General science",
        question:
          "Create a mixed revision set that covers the main Form 1 topics for Zimbabwean learners.",
        experimentHint:
          "Propose a mini-science fair where groups design small demonstrations for different Form 1 topics."
      }
    };

    let currentChapter = null;

    // --- Helper: call backend ---
    async function callApi(endpoint, payload) {
      try {
        const res = await fetch(`${API_BASE}/${endpoint}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          throw new Error("Network response was not ok");
        }

        const data = await res.json();
        return data;
      } catch (err) {
        console.error(err);
        return { answer: "Error: Could not contact Sci-Guru backend." };
      }
    }

    function setLoading(targetDiv, label) {
      targetDiv.textContent = label + " (loading…)";
    }

    // --- Buttons: Ask, Quiz, Practical ---

    btnExplain.addEventListener("click", async () => {
      const form = formSelect.value;
      const topic = topicSelect.value || "General science";
      const question = questionInput.value.trim();

      if (!question) {
        alert("Please type a question first.");
        return;
      }

      setLoading(explanationDiv, "Sci-Guru is thinking");

      const extraContext =
        currentChapter && chapterConfig[currentChapter]
          ? `\n\nChapter tag: ${chapterConfig[currentChapter].label}.`
          : "";

      const payload = { form, topic, question: question + extraContext };
      const data = await callApi("explain", payload);
      explanationDiv.textContent = data.answer || "No answer returned.";
    });

    btnQuiz.addEventListener("click", async () => {
      const form = formSelect.value;
      const topic = topicSelect.value || "General science";
      const question = questionInput.value.trim() || "Create a quiz for this topic.";

      setLoading(quizDiv, "Generating quiz questions");

      const extraContext =
        currentChapter && chapterConfig[currentChapter]
          ? `\n\nChapter tag: ${chapterConfig[currentChapter].label}.`
          : "";

      const payload = { form, topic, question: question + extraContext };
      const data = await callApi("quiz", payload);
      quizDiv.textContent = data.answer || "No quiz returned.";
    });

    btnPractical.addEventListener("click", async () => {
      const form = formSelect.value;
      const topic = topicSelect.value || "General science";
      const baseQuestion =
        questionInput.value.trim() ||
        "Design a simple practical experiment for this topic.";

      const chapterHint =
        currentChapter && chapterConfig[currentChapter]
          ? `\n\nFocus the practical on this chapter: ${chapterConfig[currentChapter].label}. Use this idea as a starting point: ${chapterConfig[currentChapter].experimentHint}`
          : "\n\nDesign a practical suitable for a low-resource Zimbabwean school.";

      setLoading(practicalDiv, "Generating practical experiment");

      const payload = {
        form,
        topic,
        question: baseQuestion + chapterHint
      };
      const data = await callApi("practical", payload);
      practicalDiv.textContent = data.answer || "No practical returned.";
    });

    // --- Save quiz score locally (per topic) ---

    btnSaveScore.addEventListener("click", () => {
      if (!saveScoreToggle.checked) {
        alert("Tick the checkbox if you want to save scores.");
        return;
      }
      const topic = topicSelect.value || "General science";
      const score = Number(scoreInput.value);
      if (Number.isNaN(score) || score < 0 || score > 100) {
        alert("Please enter a valid score between 0 and 100.");
        return;
      }

      const key = "sg_form1_topic_scores";
      const stored = JSON.parse(localStorage.getItem(key) || "{}");
      stored[topic] = Math.max(stored[topic] || 0, score);
      localStorage.setItem(key, JSON.stringify(stored));
      alert("Score saved on this device.");
    });

    // --- Chapter tag behaviour ---

    chapterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const ch = Number(btn.dataset.ch);
        const cfg = chapterConfig[ch];
        currentChapter = ch;

        // Visual active state
        chapterButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        // Fill topic dropdown
        if (cfg && cfg.topic) {
          let matched = false;
          for (const opt of topicSelect.options) {
            if (opt.value === cfg.topic) {
              topicSelect.value = cfg.topic;
              matched = true;
              break;
            }
          }
          if (!matched) {
            topicSelect.value = "";
          }
        }

        // Fill question box
        if (cfg && cfg.question) {
          questionInput.value = cfg.question;
        }

        // Status text
        chapterStatus.textContent = `Chapter tag selected: ${cfg.label}`;
      });
    });

    // --- Virtual lab hub opener ---

    function openVirtualLabHub() {
      window.open("sim-hub.html", "_blank");
    }

    window.openVirtualLabHub = openVirtualLabHub;
  </script>
</body>
</html>
