<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sci-Guru Tutor • Book 1 (Form 1)</title>
  <link rel="icon" href="lec-logo.jpg"/>

  <style>
    :root{
      --bg1:#0b1220; --bg2:#081a3b;
      --card:rgba(255,255,255,.07);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf2ff;
      --muted:rgba(234,242,255,.72);
      --blue:#2f7bff;
      --blue2:#7c5cff;
      --good:#33d07a;
      --warn:#ffcc66;
      --bad:#ff5a6b;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(47,123,255,.34), transparent 60%),
        radial-gradient(900px 500px at 90% 30%, rgba(124,92,255,.22), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{max-width:1200px; margin:0 auto; padding:14px 14px 40px}

    header{
      position:sticky; top:10px; z-index:10;
      max-width:1200px; margin:0 auto;
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      border-radius:16px;
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0}
    .logo{
      width:44px;height:44px;border-radius:12px;overflow:hidden;
      border:1px solid var(--stroke); background:rgba(255,255,255,.06);
      display:flex;align-items:center;justify-content:center; flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .brand .t{min-width:0}
    .brand .t b{display:block; font-size:16px}
    .brand .t span{display:block; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    nav{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      text-decoration:none;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      transition:transform .08s ease, background .15s ease;
      user-select:none;
    }
    .btn:hover{background:rgba(255,255,255,.10)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      border-color:rgba(47,123,255,.55);
      background:linear-gradient(135deg, rgba(47,123,255,.95), rgba(124,92,255,.55));
      color:#071022;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .dot{width:9px;height:9px;border-radius:99px;background:var(--good);box-shadow:0 0 0 4px rgba(51,208,122,.14)}

    .hero{
      margin-top:12px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      border-radius:18px;
      padding:14px;
      display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }
    .hero h1{margin:0; font-size:18px}
    .hero p{margin:4px 0 0; color:var(--muted); font-size:13px; line-height:1.5; max-width:820px}

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr 1.1fr;
      gap:12px;
      align-items:stretch;
    }
    @media(max-width:980px){ .grid{grid-template-columns:1fr} }

    .panel{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      border-radius:18px;
      overflow:hidden;
    }
    .panelHead{
      padding:14px;
      border-bottom:1px solid var(--stroke);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:rgba(0,0,0,.18);
    }
    .panelHead h2{margin:0; font-size:14px}
    .panelHead small{color:var(--muted)}
    .panelBody{padding:12px}

    textarea, input, select{
      width:100%;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      color:var(--text);
      border-radius:14px;
      padding:12px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:130px; resize:vertical}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    @media(max-width:740px){.row{grid-template-columns:1fr}}

    .actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .out{
      margin-top:10px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px;
      min-height:120px;
      white-space:pre-wrap;
      color:var(--text);
    }
    .hint{margin-top:8px; font-size:12px; color:var(--muted)}

    /* Topics */
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--muted);
      font-weight:900;
      font-size:12px;
      cursor:pointer;
    }
    .tab.active{
      color:#071022;
      border-color:rgba(47,123,255,.55);
      background:linear-gradient(135deg, rgba(47,123,255,.95), rgba(124,92,255,.55));
    }

    .searchRow{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .searchRow input{flex:1}
    .kpi{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .kpi .pill{border-radius:12px}

    .topicList{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
    }
    .topicCard{
      grid-column: span 6;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      border-radius:16px;
      overflow:hidden;
    }
    @media(max-width:980px){ .topicCard{grid-column: span 12;} }

    .topicTop{
      padding:12px;
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
      border-bottom:1px solid var(--stroke);
      background:rgba(0,0,0,.14);
    }
    .topicTitle b{display:block}
    .topicTitle span{display:block; margin-top:4px; font-size:12px; color:var(--muted)}
    .chk{display:flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); white-space:nowrap}

    details{padding:12px}
    summary{
      cursor:pointer;
      font-weight:900;
      color:var(--text);
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    .bullets{margin-top:10px; color:var(--muted); font-size:12px; line-height:1.5}
    .bullets ul{margin:8px 0 0 18px; padding:0}
    .bullets li{margin:6px 0}
    .links{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .mini{
      padding:9px 10px;
      border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      text-decoration:none;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
    }
    .mini.primary{
      background:linear-gradient(135deg, rgba(47,123,255,.95), rgba(124,92,255,.55));
      color:#071022;
      border-color:rgba(47,123,255,.55);
    }
    .mini.disabled{
      opacity:.45;
      pointer-events:none;
    }
    .note{margin-top:10px}
    .note label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .note textarea{min-height:70px; font-size:12px; padding:10px; border-radius:12px}

    footer{
      margin-top:16px;
      text-align:center;
      color:rgba(234,242,255,.62);
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">
          <img src="lec-logo.jpg" alt="LEC Biotec Logo" onerror="this.style.display='none'; this.parentElement.textContent='SG';"/>
        </div>
        <div class="t">
          <b>Sci-Guru Tutor • Book 1</b>
          <span>Form 1 Combined Science • Topics 1–19 (Term structured)</span>
        </div>
      </div>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
        <div class="pill"><span class="dot"></span> Progress auto-saves</div>
        <nav>
          <a class="btn" href="index.html">Home</a>
          <a class="btn primary" href="tutor.html">Tutor</a>
          <a class="btn" href="labs.html">Labs</a>
          <a class="btn" href="dashboard.html">Dashboard</a>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div>
        <h1>Book 1 Tutor Dashboard (Form 1)</h1>
        <p>
          This tutor is structured exactly by your summary: <b>Biology Term 1 (1–7)</b>, <b>Chemistry Term 2 (8–13)</b>, <b>Physics Term 3 (14–19)</b>.
          Each topic has: overview, key points, experiments, and a place to build virtual labs without losing progress.
        </p>
      </div>

      <div class="kpi">
        <div class="pill">Topics: <b id="kTopics" style="color:var(--text)">19</b></div>
        <div class="pill">Done: <b id="kDone" style="color:var(--text)">0</b></div>
        <div class="pill">Remaining: <b id="kLeft" style="color:var(--text)">19</b></div>
      </div>
    </section>

    <div class="grid">
      <!-- LEFT: Tutor Q/A -->
      <section class="panel">
        <div class="panelHead">
          <div>
            <h2>AI Tutor (Offline mode)</h2>
            <small>Use topics & experiments below • connect backend later</small>
          </div>
        </div>

        <div class="panelBody">
          <textarea id="q" placeholder="Ask a question (e.g., Name three types of cell. What is SI unit for mass? Define catalyst.)"></textarea>

          <div class="row">
            <div>
              <label style="font-size:12px;color:var(--muted)">Level</label>
              <select id="level">
                <option>Form 1</option>
                <option>Form 2</option>
                <option>Form 3</option>
                <option>Form 4</option>
              </select>
            </div>
            <div>
              <label style="font-size:12px;color:var(--muted)">Topic</label>
              <select id="topicPick"></select>
            </div>
          </div>

          <div class="actions">
            <button class="btn primary" id="askBtn" type="button">Answer</button>
            <button class="btn" id="quizBtn" type="button">Generate Quiz</button>
            <button class="btn" id="pracBtn" type="button">Practical Steps</button>
            <button class="btn" id="clearBtn" type="button">Clear</button>
          </div>

          <div class="out" id="out"></div>

          <div class="hint">
            ✅ This page saves topic completion + notes in your browser automatically.
          </div>
        </div>
      </section>

      <!-- RIGHT: Virtual Lab quick links -->
      <section class="panel">
        <div class="panelHead">
          <div>
            <h2>Virtual Lab Hub (Quick Open)</h2>
            <small>Correct filenames • avoid 404</small>
          </div>
        </div>
        <div class="panelBody">
          <div class="links">
            <a class="mini primary" href="labs-hub.html">Open Labs Hub</a>
            <a class="mini" href="sim-density.html">Density</a>
            <a class="mini" href="sim-electricity.html">Electricity (Series)</a>
            <a class="mini" href="sim-bunsen.html">Bunsen</a>
            <a class="mini" href="sim-apparatus.html">Apparatus</a>
            <a class="mini" href="sim-microscope.html">Microscope</a>
            <a class="mini" href="sim-cells-hub.html">Cells Hub</a>
            <a class="mini" href="sim-cells-labels.html">Cell Labeling</a>
          </div>

          <div class="hint" style="margin-top:10px;">
            If <b>labs.html</b> was giving 404, keep the small redirect file we created earlier:
            <span style="color:var(--muted)">labs.html → labs-hub.html</span>.
          </div>
        </div>
      </section>
    </div>

    <!-- TOPICS / TERMS -->
    <section class="panel" style="margin-top:12px;">
      <div class="panelHead">
        <div>
          <h2>Topics (Structured by Term)</h2>
          <small>Open details • tick Done • write notes • add virtual experiments step-by-step</small>
        </div>
        <div class="tabs" id="tabs"></div>
      </div>

      <div class="panelBody">
        <div class="searchRow">
          <input id="search" placeholder="Search topics (e.g., cells, respiration, filtration, force, electricity)"/>
          <button class="btn" id="exportBtn" type="button">Export Progress</button>
          <button class="btn" id="resetBtn" type="button" title="Resets saved ticks/notes only">Reset Progress</button>
        </div>

        <div class="topicList" id="topicList"></div>
      </div>
    </section>

    <footer>© 2025 LEC Biotec • sales@lecbiotec.com • Harare, Zimbabwe</footer>
  </div>

  <script>
    // =========================
    // DATA: Topics 1–19 (from your summary)
    // =========================
    const TOPICS = [
      // Biology Term 1
      {
        id:"t1", term:"Biology Term 1", num:1,
        name:"Laboratory safety and apparatus",
        overview:"Lab rules, safety symbols, correct use of apparatus, and accurate measurements (e.g., meniscus).",
        keyPoints:[
          "Identify common apparatus: test tubes, beakers, measuring cylinders, funnels, Bunsen burner, crucible, tripod, safety glasses.",
          "Safety symbols: corrosive, toxic, flammable, etc.",
          "Accurate measurement: read the meniscus at eye level; avoid parallax error."
        ],
        experiments:[
          {title:"Measurement practice", aim:"Practice reading the meniscus & recording volume correctly."}
        ],
        links:[
          {label:"Apparatus Explorer", href:"sim-apparatus.html", primary:true},
          {label:"Bunsen Burner", href:"sim-bunsen.html"},
        ]
      },
      {
        id:"t2", term:"Biology Term 1", num:2,
        name:"Cells and levels of organisation",
        overview:"Plant vs animal cells; cell structures; levels: cell → tissue → organ → system → organism.",
        keyPoints:[
          "All cells: cytoplasm, cell membrane, nucleus, organelles.",
          "Plant cells: cell wall (cellulose), chloroplasts, large permanent vacuole.",
          "Animal cells: no cell wall/chloroplasts; irregular shape; small/temporary vacuoles.",
          "Levels of organisation: cells form tissues, tissues form organs, organs form systems."
        ],
        experiments:[
          {title:"Observe plant cells", aim:"View onion/leaf cells and identify parts."},
          {title:"Observe animal cells", aim:"View cheek cells and identify parts."}
        ],
        links:[
          {label:"Cells Hub", href:"sim-cells-hub.html", primary:true},
          {label:"Cell Labeling", href:"sim-cells-labels.html"},
          {label:"Levels Simulator", href:"sim-levels.html"}
        ]
      },
      {
        id:"t3", term:"Biology Term 1", num:3,
        name:"Nutrition",
        overview:"Balanced diet and nutrients: carbohydrates, fats, proteins, vitamins, mineral salts, fibre, and water.",
        keyPoints:[
          "Carbohydrates & fats: energy supply.",
          "Proteins: growth and repair.",
          "Vitamins & minerals: health and growth.",
          "Fibre: aids digestion; Water: supports chemical reactions."
        ],
        experiments:[
          {title:"Food group classification", aim:"Classify foods by nutrient group and plan a balanced meal."}
        ],
        links:[]
      },
      {
        id:"t4", term:"Biology Term 1", num:4,
        name:"The respiratory system",
        overview:"Composition of air and difference between breathing and respiration; tests for oxygen and CO₂.",
        keyPoints:[
          "Air composition: ~78% nitrogen, ~21% oxygen, small carbon dioxide.",
          "Breathing: moving air in/out of lungs.",
          "Respiration: chemical reactions in cells releasing energy.",
          "Test oxygen: glowing splint; Test CO₂: limewater turns milky."
        ],
        experiments:[
          {title:"Test for oxygen", aim:"Use a glowing splint to show oxygen supports burning."},
          {title:"Test for carbon dioxide", aim:"Bubble exhaled air through limewater to show CO₂ presence."}
        ],
        links:[]
      },
      {
        id:"t5", term:"Biology Term 1", num:5,
        name:"Transport systems",
        overview:"Diffusion and osmosis; human blood components and their functions.",
        keyPoints:[
          "Diffusion: particles move from high to low concentration.",
          "Osmosis: water moves through a partially permeable membrane from high to low water concentration.",
          "Blood: plasma (liquid), RBCs (oxygen via haemoglobin), WBCs (defense), platelets (clotting)."
        ],
        experiments:[
          {title:"Diffusion demo", aim:"Observe dye spreading in water."}
        ],
        links:[]
      },
      {
        id:"t6", term:"Biology Term 1", num:6,
        name:"Reproductive systems",
        overview:"Sexual reproduction in plants and humans; flower structure; pollination; fertilisation; puberty changes.",
        keyPoints:[
          "Flower: stamen (male) and carpel (female).",
          "Pollination: transfer of pollen; fertilisation: fusion of gametes in ovule.",
          "Ovule becomes seed; ovary becomes fruit.",
          "Puberty: physical changes preparing body for reproduction."
        ],
        experiments:[
          {title:"Flower dissection", aim:"Identify sepals, petals, stamens, stigma, style, ovary, ovules."}
        ],
        links:[]
      },
      {
        id:"t7", term:"Biology Term 1", num:7,
        name:"Health and diseases",
        overview:"Personal/food/environmental hygiene, waste disposal, infectious diseases and transmission.",
        keyPoints:[
          "Hygiene: personal, food and environmental hygiene reduce disease.",
          "Waste disposal: landfill/burying, burning, recycling.",
          "Diseases: cholera/typhoid (water/food), malaria (mosquito vector), bilharzia (snails)."
        ],
        experiments:[
          {title:"Hygiene risk mapping", aim:"Identify sources of infection and propose prevention measures."}
        ],
        links:[]
      },

      // Chemistry Term 2
      {
        id:"t8", term:"Chemistry Term 2", num:8,
        name:"Separation",
        overview:"Separating mixtures using physical methods: filtration, magnetism, winnowing, decanting, evaporation.",
        keyPoints:[
          "Filtration: insoluble solid from liquid (filter paper).",
          "Magnetism: separate iron filings from mixture.",
          "Decanting: liquids of different densities (oil/water).",
          "Evaporation: recover soluble solid (crystals) from solution."
        ],
        experiments:[
          {title:"Filter sand and water", aim:"Use filtration to separate an insoluble solid."},
          {title:"Magnet separation", aim:"Separate iron filings from sulfur/other solids."}
        ],
        links:[
          {label:"(Add later) Separation Simulator", href:"#", primary:true, disabled:true}
        ]
      },
      {
        id:"t9", term:"Chemistry Term 2", num:9,
        name:"Matter",
        overview:"Kinetic theory; states of matter; changes of state; dissolving and solubility; elements, compounds, mixtures; periodic table.",
        keyPoints:[
          "Solids: particles packed, vibrate; Liquids: particles move slowly; Gases: far apart, move fast.",
          "Changes of state: melting, evaporation, condensation, freezing, sublimation.",
          "Rate of dissolving depends on particle size, temperature, stirring.",
          "Elements vs compounds vs mixtures; metals/non-metals/semimetals."
        ],
        experiments:[
          {title:"Changes of state", aim:"Observe melting/evaporation/sublimation with safe materials."}
        ],
        links:[]
      },
      {
        id:"t10", term:"Chemistry Term 2", num:10,
        name:"Acids, bases and salts",
        overview:"Properties of acids/bases; indicators; neutralisation forming salts.",
        keyPoints:[
          "Acids: sour, turn blue litmus red.",
          "Bases: bitter/soapy, turn red litmus blue.",
          "Indicators: litmus and others.",
          "Neutralisation: acid + base → salt + water."
        ],
        experiments:[
          {title:"Indicator tests", aim:"Test substances using litmus to classify acidic/basic."}
        ],
        links:[]
      },
      {
        id:"t11", term:"Chemistry Term 2", num:11,
        name:"Industrial processes",
        overview:"Peanut butter and peanut oil production steps (local industrial process example).",
        keyPoints:[
          "Steps: cleaning, shelling, grading, roasting, blanching, grinding, packaging.",
          "Oil extraction: oil press or decanting after processing.",
          "Uses: cooking, frying, skin moisturiser."
        ],
        experiments:[
          {title:"Process flow chart", aim:"Create a clear process diagram from raw peanuts to product."}
        ],
        links:[]
      },
      {
        id:"t12", term:"Chemistry Term 2", num:12,
        name:"Oxidation",
        overview:"Oxidation as addition of oxygen; rusting conditions; prevention methods (painting, galvanising, electroplating).",
        keyPoints:[
          "Rusting needs iron + oxygen + water.",
          "Prevent rust by blocking air/water contact: paint, grease, galvanise, electroplate."
        ],
        experiments:[
          {title:"Rusting conditions", aim:"Compare rusting with/without water/oxygen (safe setup)."}
        ],
        links:[]
      },
      {
        id:"t13", term:"Chemistry Term 2", num:13,
        name:"Organic chemistry",
        overview:"Organic compounds (hydrocarbons); fuels; combustion; fuel types and efficiency.",
        keyPoints:[
          "Organic chemistry studies carbon + hydrogen compounds.",
          "Fuels: solid (wood/coal), liquid (petrol/diesel/paraffin), gas (LPG/natural gas).",
          "Fuel efficiency depends on heat energy produced during combustion."
        ],
        experiments:[
          {title:"Fuel comparison (theory)", aim:"Compare fuel advantages/disadvantages and safety."}
        ],
        links:[]
      },

      // Physics Term 3
      {
        id:"t14", term:"Physics Term 3", num:14,
        name:"Data presentation",
        overview:"Present and interpret investigation data using tallies, tables and bar graphs.",
        keyPoints:[
          "Tallies record frequency using groups of five.",
          "Tables organize values in rows and columns.",
          "Bar graphs show categories visually."
        ],
        experiments:[
          {title:"Make a bar graph", aim:"Collect simple class data and draw a correct bar graph."}
        ],
        links:[]
      },
      {
        id:"t15", term:"Physics Term 3", num:15,
        name:"Measurements",
        overview:"Accurate measurement, SI units, instruments, and errors (parallax, zero error).",
        keyPoints:[
          "SI units: length (m), mass (kg), time (s), temperature (°C or K).",
          "Instruments: metre rule, stopwatch, balance, thermometer.",
          "Errors: parallax (wrong angle), zero error (not set to zero)."
        ],
        experiments:[
          {title:"Measurement accuracy", aim:"Measure length/mass/time with correct instruments and note errors."}
        ],
        links:[]
      },
      {
        id:"t16", term:"Physics Term 3", num:16,
        name:"Force",
        overview:"Force as push/pull; effects; contact vs non-contact forces; weight in newtons; force meter.",
        keyPoints:[
          "Forces change motion, shape, direction.",
          "Contact forces: friction, mechanical push/pull.",
          "Non-contact: gravity, magnetic, electrostatic.",
          "Weight is gravitational force; unit is newton (N)."
        ],
        experiments:[
          {title:"Friction investigation", aim:"Compare friction on different surfaces."}
        ],
        links:[]
      },
      {
        id:"t17", term:"Physics Term 3", num:17,
        name:"Energy",
        overview:"Energy forms, sources (renewable/non-renewable), conversions, and energy converters.",
        keyPoints:[
          "Kinetic energy: movement.",
          "Potential: gravitational, elastic, chemical.",
          "Other: light, heat, electrical, sound.",
          "Energy conversions represented by chains."
        ],
        experiments:[
          {title:"Energy chain mapping", aim:"Trace energy conversions in common devices (torch, battery, bulb)."}
        ],
        links:[]
      },
      {
        id:"t18", term:"Physics Term 3", num:18,
        name:"Magnetism",
        overview:"Magnetic materials, poles, types of magnets, electromagnets, magnetic field, compass and Earth’s field.",
        keyPoints:[
          "Magnets attract magnetic materials; force strongest at poles.",
          "Electromagnet: current through coil around iron core.",
          "Compass aligns with Earth’s magnetic field."
        ],
        experiments:[
          {title:"Make an electromagnet", aim:"Coil wire around nail, connect to cell, test attraction."}
        ],
        links:[]
      },
      {
        id:"t19", term:"Physics Term 3", num:19,
        name:"Electricity",
        overview:"Charges, static vs current electricity, conductors/insulators, d.c. circuit components and symbols.",
        keyPoints:[
          "Charge: positive/protons, negative/electrons; friction transfers electrons.",
          "Static electricity: charge build-up; current electricity: flow in conductor.",
          "Circuit parts: cell, wires, bulb, resistor, ammeter, voltmeter, switch and symbols."
        ],
        experiments:[
          {title:"Simple circuit", aim:"Build/test a d.c. circuit and identify components."},
          {title:"Series circuit (added)", aim:"Compare brightness/current with 1 bulb vs series bulbs."}
        ],
        links:[
          {label:"Electricity Simulator (Series)", href:"sim-electricity.html", primary:true}
        ]
      }
    ];

    // mark disabled links in data without breaking rendering
    function normalizeLinks(topic){
      const links = topic.links || [];
      return links.map(l => ({
        label:l.label,
        href:l.href,
        primary: !!l.primary,
        disabled: !!l.disabled
      }));
    }

    // =========================
    // STORAGE
    // =========================
    const STORE_KEY = "sciguru_book1_topics_progress_v2";
    function loadStore(){
      try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || {}; }
      catch(e){ return {}; }
    }
    function saveStore(s){
      localStorage.setItem(STORE_KEY, JSON.stringify(s));
    }
    const store = loadStore();

    // =========================
    // TABS
    // =========================
    const TERMS = ["All", "Biology Term 1", "Chemistry Term 2", "Physics Term 3"];
    const tabsEl = document.getElementById("tabs");
    let activeTerm = "All";

    function renderTabs(){
      tabsEl.innerHTML = "";
      TERMS.forEach(t=>{
        const b = document.createElement("button");
        b.className = "tab" + (t===activeTerm ? " active":"");
        b.textContent = t;
        b.type = "button";
        b.addEventListener("click", ()=>{
          activeTerm = t;
          renderTabs();
          renderTopics();
        });
        tabsEl.appendChild(b);
      });
    }

    // =========================
    // TOPIC PICKER FOR TUTOR
    // =========================
    const topicPick = document.getElementById("topicPick");
    function fillTopicPicker(){
      topicPick.innerHTML = "";
      TOPICS.forEach(t=>{
        const op = document.createElement("option");
        op.value = t.id;
        op.textContent = `Topic ${t.num}: ${t.name}`;
        topicPick.appendChild(op);
      });
      topicPick.value = "t1";
    }

    // =========================
    // KPIs
    // =========================
    function calcDone(){
      let done = 0;
      TOPICS.forEach(t=>{
        const st = store[t.id] || {};
        if(st.done) done++;
      });
      return done;
    }
    function renderKPIs(){
      const done = calcDone();
      document.getElementById("kDone").textContent = done;
      document.getElementById("kLeft").textContent = TOPICS.length - done;
      document.getElementById("kTopics").textContent = TOPICS.length;
    }

    // =========================
    // TOPICS RENDER
    // =========================
    const listEl = document.getElementById("topicList");
    const searchEl = document.getElementById("search");

    function escapeHtml(s){
      return (s||"")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;");
    }

    function topicMatches(topic, q){
      if(!q) return true;
      q = q.toLowerCase();
      const hay = [
        topic.term, topic.name, topic.overview,
        (topic.keyPoints||[]).join(" "),
        (topic.experiments||[]).map(e=>e.title+" "+e.aim).join(" ")
      ].join(" ").toLowerCase();
      return hay.includes(q);
    }

    function renderTopics(){
      listEl.innerHTML = "";
      const q = (searchEl.value||"").trim();

      TOPICS
        .filter(t => activeTerm==="All" ? true : t.term===activeTerm)
        .filter(t => topicMatches(t, q))
        .forEach(topic=>{
          const st = store[topic.id] || {done:false, note:""};
          const links = normalizeLinks(topic);

          const card = document.createElement("div");
          card.className = "topicCard";

          card.innerHTML = `
            <div class="topicTop">
              <div class="topicTitle">
                <b>Topic ${topic.num}: ${escapeHtml(topic.name)}</b>
                <span>${escapeHtml(topic.term)} • ${escapeHtml(topic.overview)}</span>
              </div>
              <label class="chk">
                <input type="checkbox" data-done="${topic.id}" ${st.done ? "checked":""}/>
                Done
              </label>
            </div>

            <details>
              <summary>Open details (Key points • Experiments • Actions)</summary>

              <div class="bullets">
                <b style="color:var(--text)">Key points</b>
                <ul>
                  ${(topic.keyPoints||[]).map(k=>`<li>${escapeHtml(k)}</li>`).join("")}
                </ul>

                <div style="height:8px"></div>
                <b style="color:var(--text)">Experiments / Activities</b>
                <ul>
                  ${(topic.experiments||[]).map(e=>`<li><b>${escapeHtml(e.title)}</b> — ${escapeHtml(e.aim)}</li>`).join("")}
                </ul>
              </div>

              <div class="links">
                ${
                  links.length
                    ? links.map(l=>`<a class="mini ${l.primary?"primary":""} ${l.disabled?"disabled":""}" href="${l.href}">${escapeHtml(l.label)}</a>`).join("")
                    : `<span class="mini disabled">Virtual experiment: coming next</span>`
                }
                <button class="mini" type="button" data-action="quiz" data-topic="${topic.id}">Generate quiz</button>
                <button class="mini" type="button" data-action="prac" data-topic="${topic.id}">Practical steps</button>
                <button class="mini" type="button" data-action="summary" data-topic="${topic.id}">Quick summary</button>
              </div>

              <div class="note">
                <label>Notes / next build (saved)</label>
                <textarea data-note="${topic.id}" placeholder="Write notes for this topic (e.g., what virtual lab to build next)">${escapeHtml(st.note||"")}</textarea>
              </div>
            </details>
          `;

          listEl.appendChild(card);
        });

      // handlers
      listEl.querySelectorAll('input[type="checkbox"][data-done]').forEach(cb=>{
        cb.addEventListener("change", ()=>{
          const id = cb.getAttribute("data-done");
          store[id] = store[id] || {};
          store[id].done = cb.checked;
          saveStore(store);
          renderKPIs();
        });
      });

      listEl.querySelectorAll('textarea[data-note]').forEach(t=>{
        t.addEventListener("input", ()=>{
          const id = t.getAttribute("data-note");
          store[id] = store[id] || {};
          store[id].note = t.value;
          saveStore(store);
        });
      });

      listEl.querySelectorAll('button[data-action]').forEach(b=>{
        b.addEventListener("click", ()=>{
          const action = b.getAttribute("data-action");
          const id = b.getAttribute("data-topic");
          runTopicAction(id, action);
        });
      });
    }

    // =========================
    // Tutor actions (offline templates)
    // =========================
    const out = document.getElementById("out");

    function getTopicById(id){
      return TOPICS.find(t=>t.id===id) || TOPICS[0];
    }

    function runTopicAction(id, action){
      const t = getTopicById(id);
      const lvl = document.getElementById("level").value;

      if(action==="summary"){
        out.textContent =
`${lvl} • Topic ${t.num}: ${t.name}

Quick summary:
- ${t.overview}

Key points:
${(t.keyPoints||[]).map(x=>"• "+x).join("\n")}

Experiments:
${(t.experiments||[]).map(e=>`• ${e.title} — ${e.aim}`).join("\n")}

Next: open the simulator (if available) or build a new virtual lab for this topic.`;
      }

      if(action==="quiz"){
        out.textContent =
`QUIZ • ${lvl} • Topic ${t.num}: ${t.name}

1) Define the main terms in this topic.
2) Explain the key idea using a Zimbabwe example.
3) Draw/label a diagram (where applicable).
4) Short questions (5):
   - 2 recall
   - 2 understanding
   - 1 application
5) Practical question:
   - Aim, apparatus, method, results, conclusion, safety.

Teacher tip:
Marking guide: give points for correct keywords + correct explanation + correct steps.`;
      }

      if(action==="prac"){
        const exp = (t.experiments||[])[0];
        out.textContent =
`PRACTICAL STEPS • ${lvl} • Topic ${t.num}: ${t.name}

${exp ? ("Suggested activity: " + exp.title + "\nAim: " + exp.aim + "\n\n") : ""}A) Aim
B) Apparatus
C) Method (step-by-step)
D) Results/Observations (table)
E) Calculations (if needed)
F) Conclusion
G) Safety precautions

Virtual lab idea:
- Build an interactive simulator that lets learners change variables and see results instantly.`;
      }

      // also align dropdown
      document.getElementById("topicPick").value = t.id;
    }

    // Manual tutor buttons
    function offlineAnswer(){
      const q = (document.getElementById("q").value||"").trim();
      if(!q){ out.textContent = "Type a question first."; return; }
      const lvl = document.getElementById("level").value;
      const t = getTopicById(document.getElementById("topicPick").value);

      out.textContent =
`${lvl} • Topic ${t.num}: ${t.name}

Your question:
${q}

Tutor response (offline template):
• Explanation: define key terms, then explain in simple steps.
• Example (Zimbabwe): connect to local life (home/school/farm/electricity/health).
• Diagram/formula: include if relevant.
• Quick check: ask 2 follow-up questions to confirm understanding.

Use the Topic details below for experiments + key points.`;
    }

    function offlineQuiz(){
      const t = getTopicById(document.getElementById("topicPick").value);
      runTopicAction(t.id, "quiz");
    }

    function offlinePractical(){
      const t = getTopicById(document.getElementById("topicPick").value);
      runTopicAction(t.id, "prac");
    }

    document.getElementById("askBtn").addEventListener("click", offlineAnswer);
    document.getElementById("quizBtn").addEventListener("click", offlineQuiz);
    document.getElementById("pracBtn").addEventListener("click", offlinePractical);
    document.getElementById("clearBtn").addEventListener("click", ()=>{
      document.getElementById("q").value = "";
      out.textContent = "";
    });

    // =========================
    // Export / Reset
    // =========================
    document.getElementById("exportBtn").addEventListener("click", ()=>{
      const data = JSON.stringify(store, null, 2);
      const blob = new Blob([data], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "sciguru-book1-topics-progress.json";
      a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById("resetBtn").addEventListener("click", ()=>{
      localStorage.removeItem(STORE_KEY);
      for(const k in store) delete store[k];
      renderKPIs();
      renderTopics();
      out.textContent = "Saved progress reset (ticks + notes). Your HTML files were NOT deleted.";
    });

    searchEl.addEventListener("input", renderTopics);

    // =========================
    // INIT
    // =========================
    renderTabs();
    fillTopicPicker();
    renderKPIs();
    renderTopics();
    out.textContent = "Ready ✅\n\nChoose a topic, open details, and we continue building virtual experiments topic-by-topic without losing progress.";
  </script>
</body>
                                                                 </html>
