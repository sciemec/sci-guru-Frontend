<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sci-Guru AI Tutor</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="lec-logo.jpg" type="image/jpeg" />
</head>
<body>
    <!-- Top bar -->
    <header class="site-header">
        <div class="nav-inner">
            <div class="brand">
                <img src="lec-logo.jpg" alt="LEC Biotec Logo" class="brand-logo" />
                <span class="brand-text">Sci-Guru Tutor</span>
            </div>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="tutor.html" class="nav-link active">AI Tutor</a>
            </nav>
        </div>
    </header>

    <main class="page-main">
        <section class="section tutor-section">
            <div class="tutor-layout">
                <!-- LEFT: Ask Sci-Guru -->
                <div class="tutor-column tutor-column-left">
                    <h2 class="section-title-small">Ask Sci-Guru</h2>
                    <p class="tutor-intro">
                        Choose a form and topic, or tap a Form 1 chapter below, then ask your question in simple English.
                    </p>

                    <label class="field-label" for="formLevel">Form / Level</label>
                    <select id="formLevel" class="field-select">
                        <option value="Form 1">Form 1</option>
                        <option value="Form 2">Form 2</option>
                        <option value="Form 3">Form 3</option>
                        <option value="Form 4">Form 4</option>
                    </select>

                    <label class="field-label" for="topic">Topic (Form 1 topics grouped + general)</label>
                    <select id="topic" class="field-select">
                        <option value="">-- Optional: choose a topic --</option>

                        <optgroup label="General">
                            <option value="General Science">General Science</option>
                        </optgroup>

                        <optgroup label="Form 1 — Biology">
                            <option value="Living things and characteristics of life">
                                Living things &amp; characteristics of life
                            </option>
                            <option value="Cells and simple microscopes">
                                Cells and simple microscopes
                            </option>
                            <option value="Human body systems and hygiene">
                                Human body systems &amp; hygiene
                            </option>
                            <option value="Ecosystems and environment">
                                Ecosystems &amp; environment
                            </option>
                        </optgroup>

                        <optgroup label="Form 1 — Chemistry & Physics">
                            <option value="States of matter">States of matter</option>
                            <option value="Mixtures and separation methods">
                                Mixtures &amp; separation methods
                            </option>
                            <option value="Density and flotation">
                                Density &amp; flotation
                            </option>
                            <option value="Electricity and magnetism">
                                Electricity &amp; magnetism
                            </option>
                        </optgroup>
                    </select>

                    <label class="field-label" for="question">Your question</label>
                    <textarea id="question" class="field-textarea" rows="4"
                        placeholder="Explain density using Zimbabwean examples..."></textarea>

                    <div class="button-row">
                        <button id="btnExplain" class="btn btn-primary">Ask Sci-Guru</button>
                        <button id="btnQuiz" class="btn btn-secondary">Generate quiz</button>
                    </div>
                    <div class="button-row">
                        <button id="btnPractical" class="btn btn-outline">Generate practical</button>
                        <button id="btnOpenLabs" class="btn btn-outline">Open virtual lab hub</button>
                    </div>

                    <div class="save-score">
                        <label class="checkbox-row">
                            <input type="checkbox" id="saveScoreChk" checked />
                            <span>I want to save my quiz result for this topic</span>
                        </label>
                        <div class="score-row">
                            <span>I scored</span>
                            <input type="number" id="scoreInput" class="score-input" placeholder="75" min="0" max="100" />
                            <span>%</span>
                            <button id="btnSaveScore" class="btn btn-small btn-success">
                                Save topic score
                            </button>
                        </div>
                        <p id="statusText" class="status-text">
                            Sci-Guru is ready. Backend: <span class="status-live">LIVE</span>.
                        </p>
                    </div>
                </div>

                <!-- RIGHT: Results -->
                <div class="tutor-column tutor-column-right">
                    <h2 class="section-title-small">Results</h2>

                    <div class="result-card">
                        <h3 class="result-title">Explanation</h3>
                        <div id="explainOutput" class="result-body">
                            Sci-Guru will answer here…
                        </div>
                    </div>

                    <div class="result-card">
                        <h3 class="result-title">Quiz</h3>
                        <div id="quizOutput" class="result-body">
                            Quiz will appear here…
                        </div>
                    </div>

                    <div class="result-card">
                        <h3 class="result-title">Practical</h3>
                        <div id="practicalOutput" class="result-body">
                            Practical experiment will appear here…
                        </div>
                    </div>

                    <!-- Clickable chapter strip -->
                    <div class="chapters-strip">
                        <div class="chapters-header">
                            <span class="chapters-title">Form 1 chapters</span>
                            <span class="chapters-note">Tap a chapter to auto-fill topic &amp; sample question</span>
                        </div>
                        <div class="chapters-pills">
                            <!-- CHAPTERS 1–8: fully wired -->
                            <button
                                class="chapter-pill"
                                data-topic="Living things and characteristics of life"
                                data-question="Explain what makes something a living thing. Use 3 examples from a Zimbabwean village or city."
                            >
                                Ch. 1
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="Cells and simple microscopes"
                                data-question="Explain what a cell is and why it is called the basic unit of life. Use simple examples a Form 1 learner can understand."
                            >
                                Ch. 2
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="Human body systems and hygiene"
                                data-question="Describe two human body systems and explain one hygiene practice that keeps each system healthy."
                            >
                                Ch. 3
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="Ecosystems and environment"
                                data-question="Explain what an ecosystem is and give one example from a rural and one from an urban area in Zimbabwe."
                            >
                                Ch. 4
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="States of matter"
                                data-question="Explain the three main states of matter using everyday examples from home or school."
                            >
                                Ch. 5
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="Mixtures and separation methods"
                                data-question="Explain what a mixture is and describe one method that can be used to separate a mixture of sand and salt."
                            >
                                Ch. 6
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="Density and flotation"
                                data-question="Explain why some objects float and others sink using the idea of density. Use at least one Zimbabwean example."
                            >
                                Ch. 7
                            </button>
                            <button
                                class="chapter-pill"
                                data-topic="Electricity and magnetism"
                                data-question="Describe a simple electric circuit and explain one safety rule about using electricity at home."
                            >
                                Ch. 8
                            </button>

                            <!-- CHAPTERS 9–17: place-holders for now -->
                            <button
                                class="chapter-pill"
                                data-label="Energy and fuels"
                                data-coming="true"
                            >
                                Ch. 9
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Light"
                                data-coming="true"
                            >
                                Ch. 10
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Sound"
                                data-coming="true"
                            >
                                Ch. 11
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Heat and temperature"
                                data-coming="true"
                            >
                                Ch. 12
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Weather and climate"
                                data-coming="true"
                            >
                                Ch. 13
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Earth and space"
                                data-coming="true"
                            >
                                Ch. 14
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Simple machines and pressure"
                                data-coming="true"
                            >
                                Ch. 15
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Acids, bases and salts"
                                data-coming="true"
                            >
                                Ch. 16
                            </button>
                            <button
                                class="chapter-pill"
                                data-label="Scientific methods and safety"
                                data-coming="true"
                            >
                                Ch. 17
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <p>© 2025 LEC BIOTEC. Sci-Guru AI Tutor prototype.</p>
    </footer>

    <!-- Simple JS to call your backend and handle chapters -->
    <script>
        const API_BASE = "https://sci-guru-backend.onrender.com/api";

        const formSelect = document.getElementById("formLevel");
        const topicSelect = document.getElementById("topic");
        const questionInput = document.getElementById("question");

        const explainOutput = document.getElementById("explainOutput");
        const quizOutput = document.getElementById("quizOutput");
        const practicalOutput = document.getElementById("practicalOutput");

        const btnExplain = document.getElementById("btnExplain");
        const btnQuiz = document.getElementById("btnQuiz");
        const btnPractical = document.getElementById("btnPractical");
        const btnOpenLabs = document.getElementById("btnOpenLabs");

        const saveScoreChk = document.getElementById("saveScoreChk");
        const scoreInput = document.getElementById("scoreInput");
        const btnSaveScore = document.getElementById("btnSaveScore");
        const statusText = document.getElementById("statusText");

        const chapterPills = document.querySelectorAll(".chapter-pill");

        async function callSciGuru(endpoint, outputElement) {
            const form = formSelect.value;
            const topic = topicSelect.value;
            const question = questionInput.value.trim();

            if (!question) {
                outputElement.textContent = "Please type a question first.";
                return;
            }

            outputElement.textContent = "Sci-Guru is thinking…";

            try {
                const res = await fetch(`${API_BASE}/${endpoint}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ form, topic, question })
                });

                if (!res.ok) {
                    throw new Error("Network response was not ok");
                }

                const data = await res.json();
                outputElement.textContent =
                    data.answer || data.quiz || data.practical || "No answer returned.";
            } catch (err) {
                console.error(err);
                outputElement.textContent = "Error: Could not connect to Sci-Guru backend.";
            }
        }

        btnExplain.addEventListener("click", () => {
            callSciGuru("explain", explainOutput);
        });

        btnQuiz.addEventListener("click", () => {
            callSciGuru("quiz", quizOutput);
        });

        btnPractical.addEventListener("click", () => {
            callSciGuru("practical", practicalOutput);
        });

        btnOpenLabs.addEventListener("click", () => {
            window.location.href = "index.html#labs";
        });

        // ---------- Topic score saving (local only) ----------
        btnSaveScore.addEventListener("click", () => {
            if (!saveScoreChk.checked) {
                statusText.textContent =
                    "Saving is disabled. Tick the box if you want to save scores.";
                return;
            }

            const score = parseFloat(scoreInput.value);
            if (isNaN(score) || score < 0 || score > 100) {
                statusText.textContent = "Please enter a score between 0 and 100.";
                return;
            }

            const form = formSelect.value;
            const topic = topicSelect.value || "Custom question";

            const key = "sciGuruBestScores";
            const stored = JSON.parse(localStorage.getItem(key) || "{}");

            if (!stored[form]) stored[form] = {};
            const previous = stored[form][topic];

            if (previous === undefined || score > previous) {
                stored[form][topic] = score;
                localStorage.setItem(key, JSON.stringify(stored));
                statusText.textContent =
                    `Saved! Best score for "${topic}" in ${form} is now ${score}%.`;
            } else {
                statusText.textContent =
                    `Not saved: you already have ${previous}% for "${topic}".`;
            }
        });

        // ---------- Chapter pills: click to auto-set topic & question ----------
        chapterPills.forEach((pill) => {
            pill.addEventListener("click", () => {
                // Remove active class from all
                chapterPills.forEach(p => p.classList.remove("active"));

                const topicValue = pill.dataset.topic;
                const sampleQuestion = pill.dataset.question;
                const coming = pill.dataset.coming === "true";
                const label = pill.dataset.label || pill.textContent.trim();

                if (coming) {
                    // Future chapters not wired yet
                    statusText.textContent =
                        `${label} content is coming soon. You can still type your own question above.`;
                } else if (topicValue) {
                    formSelect.value = "Form 1";
                    topicSelect.value = topicValue;

                    if (sampleQuestion) {
                        questionInput.value = sampleQuestion;
                    }

                    pill.classList.add("active");
                    statusText.textContent =
                        `Ready: ${label} selected (Form 1, topic pre-filled). You can edit the question or press a button to continue.`;
                }
            });
        });
    </script>
</body>
</html>
