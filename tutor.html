<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sci-Guru AI Tutor</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container row">
      <div class="brand">
        <img src="images/lec-logo.png" alt="LEC Biotec Logo">
        <div class="title">
          <b>Sci-Guru AI Science Tutor</b>
          <span>ZIMSEC / Heritage-Based curriculum</span>
        </div>
      </div>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a class="active" href="tutor.html">AI Tutor</a>
        <a href="virtual-lab-hub.html">Virtual Lab Hub</a>
      </nav>
    </div>
  </header>

  <main class="container" style="padding:18px 0 30px;">
    <div class="split">
      <section class="card">
        <h2>Ask Sci-Guru</h2>
        <p class="small">Choose Form and Topic, then ask a question.</p>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
          <span class="badge" id="apiStatus">API: checking...</span>
          <span class="badge">Render Free may sleep</span>
        </div>

        <label class="small" for="form">Form / Level</label>
        <select id="form" class="input">
          <option value="Form 1">Form 1</option>
          <option value="Form 2">Form 2</option>
          <option value="Form 3">Form 3</option>
          <option value="Form 4">Form 4</option>
        </select>

        <div style="height:10px"></div>

        <label class="small" for="topic">Topic</label>
        <select id="topic" class="input">
          <option value="">Optional: choose a topic</option>
        </select>

        <div style="height:10px"></div>

        <label class="small" for="q">Your question</label>
        <textarea id="q" class="input" placeholder="e.g. Explain measurement in science..."></textarea>

        <div style="height:10px"></div>

        <div class="actions">
          <button class="btn primary" id="askBtn">Ask Sci-Guru</button>
          <button class="btn" id="quizBtn">Generate quiz</button>
          <button class="btn" id="pracBtn">Generate practical</button>
          <a class="btn" href="virtual-lab-hub.html">Open virtual lab hub</a>
        </div>

        <div style="margin-top:14px" class="small">
          Tip: If you don’t select a topic, Sci-Guru answers generally for the chosen Form.
        </div>
      </section>

      <section class="card">
        <h2>Output</h2>
        <p class="small">Your explanation / quiz / practical will appear here.</p>
        <div id="out" class="card" style="background:rgba(255,255,255,.03); border-radius:12px; border:1px solid var(--border); box-shadow:none;">
          <p class="small" style="margin:0">No response yet.</p>
        </div>
      </section>
    </div>
  </main>

  <script>
    // ✅ Your Render backend base URL:
    const API_BASE = "https://sci-guru-backend.onrender.com";

    const TOPICS = {
      "Form 1": ["Measurement & Safety","States of Matter","Density","Separation of Mixtures","Electric Circuits (Basics)"],
      "Form 2": ["Forces & Pressure","Energy & Heat","Cells & Microscopes","Acids, Bases & Salts"],
      "Form 3": ["Chemical Reactions","Electricity & Magnetism","Ecology & Environment"],
      "Form 4": ["Rates of Reaction","Genetics (Basics)","Waves & Light","Organic Chemistry (Basics)"]
    };

    const formEl = document.getElementById('form');
    const topicEl = document.getElementById('topic');
    const qEl = document.getElementById('q');
    const outEl = document.getElementById('out');
    const apiStatusEl = document.getElementById('apiStatus');

    function loadTopics() {
      const f = formEl.value;
      const items = TOPICS[f] || [];
      topicEl.innerHTML = '<option value="">Optional: choose a topic</option>' +
        items.map(t => `<option value="${t}">${t}</option>`).join('');
    }

    function render(text) {
      outEl.innerHTML = `<div style="white-space:pre-wrap; line-height:1.6">${text}</div>`;
    }

    async function checkHealth(){
      try{
        const r = await fetch(`${API_BASE}/health`, { method:"GET" });
        if(!r.ok) throw new Error("Health not OK");
        apiStatusEl.textContent = "API: online";
      }catch(e){
        apiStatusEl.textContent = "API: offline / sleeping";
      }
    }

    async function callTutor(mode){
      const payload = {
        mode,
        form: formEl.value,
        topic: topicEl.value || "General",
        question: qEl.value.trim()
      };

      if (!payload.question) {
        render("Please type a question first.");
        return;
      }

      render("Loading... (first request may take longer if Render was sleeping)");
      try {
        const r = await fetch(`${API_BASE}/api/tutor`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await r.json().catch(() => ({}));
        if (!r.ok) throw new Error(data?.detail || data?.error || `Request failed (${r.status})`);

        render(data.text || "No text returned.");
      } catch (e) {
        render("Error: " + e.message);
      }
    }

    document.getElementById('askBtn').onclick  = () => callTutor("Explain");
    document.getElementById('quizBtn').onclick = () => callTutor("Quiz");
    document.getElementById('pracBtn').onclick = () => callTutor("Practical");
    formEl.addEventListener('change', loadTopics);

    loadTopics();
    checkHealth();
  </script>
</body>
            </html>
